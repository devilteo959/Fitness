<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Workout Superserie ‚Äì 6 settimane</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --bg:#f8fafc; --card:#ffffff; --text:#0b1220; --muted:#64748b; --border:#e2e8f0; --primary:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
         color:var(--text); background:var(--bg);}
    header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border)}
    .wrap{max-width:780px;margin:0 auto;padding:.75rem 1rem;display:flex;align-items:center;justify-content:space-between;gap:.75rem}
    h1{font-size:1.125rem;margin:0;font-weight:700}
    select,button,input[type="number"],input[type="text"]{
      border:1px solid #cbd5e1;border-radius:.6rem;padding:.45rem .6rem;font-size:.95rem;background:#fff
    }
    .btn{border-radius:.75rem;padding:.55rem .8rem;font-weight:600;box-shadow:0 1px 4px rgba(0,0,0,.06)}
    .ghost{background:#f1f5f9}
    .primary{background:var(--primary);color:#fff;border-color:transparent}
    main{max-width:780px;margin:0 auto;padding:1rem 1rem 5rem}
    .card{background:var(--card);border-radius:1rem;box-shadow:0 2px 10px rgba(0,0,0,.05);padding:1rem;margin:.75rem 0;border:1px solid var(--border)}
    .muted{color:var(--muted);font-size:.92rem}
    .row{display:flex;align-items:center;justify-content:space-between;gap:.75rem}
    .grid{display:grid;gap:.75rem}
    .two{grid-template-columns:1fr 1fr}
    .three{grid-template-columns:repeat(3,1fr)}
    .title{font-size:1rem;font-weight:700;margin:0}
    .subtitle{font-size:.95rem;margin:.25rem 0 0}
    .chip{display:inline-flex;align-items:center;gap:.5rem;border-radius:999px;padding:.25rem .75rem;background:#f1f5f9}
    .volbox{text-align:right}
    .vol{font-weight:800}
    .sep{height:1px;background:var(--border);margin:.5rem 0}
    .tab-nav{display:flex;border-bottom:1px solid var(--border);padding:0 1rem;gap:1rem;margin-top:.5rem}
    .tab-btn{border:none;background:transparent;padding:.75rem 0;font-size:1rem;color:var(--muted);border-bottom:2px solid transparent}
    .tab-btn.active{color:var(--primary);border-bottom-color:var(--primary);font-weight:600}
    .input-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
    .input-grid label{font-size:.85rem;color:var(--muted)}
    .input-grid input{width:100%;margin-top:.2rem}
    .title-input{flex-grow:1;background:transparent;border:none;font-size:1rem;font-weight:700;padding:0}
    .title-input:focus{outline:none;border-bottom:1px solid var(--primary);}
    .superset-form{border-top:1px solid var(--border);padding-top:.75rem;margin-top:.75rem}
    .superset-form:first-of-type{border-top:none;margin-top:0;padding-top:0}
    .form-group{margin-bottom:.5rem}
    .form-group label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:.2rem}
    .form-group input{width:100%}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Workout Superserie</h1>
      <div class="row" style="gap:.5rem">
        <select id="weekSelect"></select>
      </div>
    </div>
    <div class="tab-nav">
        <button id="tabAllenamento" class="tab-btn active">Allenamento</button>
        <button id="tabGrafico" class="tab-btn">Riepilogo Grafico</button>
        <button id="tabModifica" class="tab-btn">Modifica Scheda</button>
    </div>
  </header>

  <main>
    <div id="allenamentoView">
      <section class="card">
        <div class="row">
          <div>
            <div class="title">Settimana & indicazioni</div>
            <p id="weekNote" class="muted"></p>
          </div>
          <div class="row" style="gap:.5rem">
            <button id="resetWeek" class="btn ghost">‚ôªÔ∏è Reset</button>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="row">
          <div class="title">Giorno</div>
        <div class="row" style="gap:.5rem" id="dayButtons">
          <!-- Day buttons will be rendered here dynamically -->
          </div>
        </div>
      </section>

      <section id="workouts" class="grid"></section>
    </div>

    <div id="graficoView" style="display:none;">
      <section class="card">
        <h2 class="title">Riepilogo Grafico</h2>
        <p class="muted">Visualizzazione dei progressi settimanali per ogni esercizio.</p>
        <div id="chartContainer" class="grid"></div>
      </section>
    </div>

    <div id="modificaView" style="display:none;">
      <div class="card">
        <div class="row">
          <h2 class="title">Gestione Piano Allenamento</h2>
        <div class="row" style="gap:.5rem">
          <button id="savePlanBtn" class="btn primary">üíæ Salva</button>
        </div>
        </div>
        <p class="muted" style="margin-top:.5rem;">Qui potrai modificare i tuoi giorni di allenamento, le superserie e gli esercizi.</p>
        <div id="planEditor" style="margin-top:1rem;"></div>
      </div>
    </div>
  </main>

<script>
/* ---------- Piano allenamento ---------- */
// Il piano √® salvato in localStorage per renderlo modificabile.
// Se non esiste, viene creato un piano di default.
let plan = JSON.parse(localStorage.getItem("ws_plan"));
if (!plan) {
  plan = {
    G1:{ titolo:"Giorno 1 ‚Äì Petto + Schiena", coppie:[
      ["Panca piana bilanciere","Rematore bilanciere","4x8‚Äì10"],
      ["Panca inclinata manubri","Pulley basso","3x10‚Äì12"],
      ["Croci ai cavi","Lat machine presa larga","3x12"],
      ["Plank","-","3x max"],
    ]},
    G2:{ titolo:"Giorno 2 ‚Äì Spalle + Braccia", coppie:[
      ["Military press","Trazioni supine","4x8‚Äì10"],
      ["Alzate laterali","Face pull","3x12"],
      ["Curl bilanciere EZ","French press sdraiato","3x10‚Äì12"],
      ["Curl manubri alternati","Push down cavi","3x12‚Äì15"],
    ]},
    G3:{ titolo:"Giorno 3 ‚Äì Gambe", coppie:[
      ["Squat","Stacco rumeno","4x8"],
      ["Affondi camminati","Hip thrust","3x10"],
      ["Leg extension","Leg curl","3x12‚Äì15"],
      ["Calf raise in piedi","Calf seduto","4x15‚Äì20"],
      ["Hanging leg raise","-","3x max"],
    ]},
  };
  localStorage.setItem("ws_plan", JSON.stringify(plan));
}

const WEEK_NOTES = {
  1:"65% 1RM ‚Äì lascia 2 reps in riserva",
  2:"70% 1RM ‚Äì lascia 1‚Äì2 reps in riserva",
  3:"75% 1RM ‚Äì lascia 1 rep in riserva",
  4:"77.5% 1RM ‚Äì lascia 0‚Äì1 reps in riserva",
  5:"80% 1RM ‚Äì vicino al cedimento",
  6:"85% 1RM ‚Äì test/overreach leggero o scarico autoregolato",
};

/* ---------- Stato + persistenza ---------- */
const state = {
  day: localStorage.getItem("ws_day") || "G1",
  week: +(localStorage.getItem("ws_week") || 1),
  data: JSON.parse(localStorage.getItem("ws_data") || "{}"),
};
function save(){ localStorage.setItem("ws_day", state.day); localStorage.setItem("ws_week", state.week); localStorage.setItem("ws_data", JSON.stringify(state.data)); }
function ensureWeek(){ if (!state.data[state.week]) state.data[state.week] = { G1:{}, G2:{}, G3:{} }; }
function keyAB(a,b){ return `${a}__${b}`; }
function val(k,f){ ensureWeek(); return state.data[state.week][state.day][k]?.[f] || ""; }
function setVal(k,f,v){ ensureWeek(); if(!state.data[state.week][state.day][k]) state.data[state.week][state.day][k]={}; state.data[state.week][state.day][k][f]=v; save(); computeVolumes(); }

/* ---------- Rendering ---------- */
const weekSelect = document.getElementById('weekSelect');
const weekNote = document.getElementById('weekNote');
const workouts = document.getElementById('workouts');

const allenamentoView = document.getElementById('allenamentoView');
const graficoView = document.getElementById('graficoView');
const modificaView = document.getElementById('modificaView');


function renderWeekSelect(){
  weekSelect.innerHTML = "";
  for(let i=1;i<=6;i++){
    const o=document.createElement('option');
    o.value=i; o.textContent=`Settimana ${i}`; if(i===state.week) o.selected=true;
    weekSelect.appendChild(o);
  }
  weekNote.textContent = WEEK_NOTES[state.week];
}

function computeVolumes(){
  document.querySelectorAll('[data-ex]').forEach(sec=>{
    const repsA = parseInt(sec.querySelector('[data-field="repsA"]').value)||0;
    const repsB = parseInt(sec.querySelector('[data-field="repsB"]').value)||0;
    const pesoA = parseFloat(sec.querySelector('[data-field="pesoA"]').value)||0;
    const pesoB = parseFloat(sec.querySelector('[data-field="pesoB"]').value)||0;
    const sr = sec.querySelector('[data-serie]').textContent.trim();
    const m = sr.match(/(\d+)x/); const n = m?parseInt(m[1]):1;
    const volA = Math.round(pesoA*repsA*n);
    const volB = Math.round(pesoB*repsB*n);
    sec.querySelector('[data-volA]').textContent = volA?volA:"-";
    sec.querySelector('[data-volB]').textContent = volB?volB:"-";
    sec.querySelector('[data-volT]').textContent = (volA||0)+(volB||0) || "-";
  });
}

function renderPlanEditor() {
  const editor = document.getElementById('planEditor');
  editor.innerHTML = ''; // Clear previous content

  // Create a sorted list of day keys to ensure order
  const dayKeys = Object.keys(plan).sort((a, b) => {
    const numA = parseInt(a.substring(1));
    const numB = parseInt(b.substring(1));
    return numA - numB;
  });

  for (const dayKey of dayKeys) {
    const day = plan[dayKey];
    const dayCard = document.createElement('div');
    dayCard.className = 'card';
    dayCard.dataset.dayKey = dayKey;
    dayCard.innerHTML = `
      <div class="row">
        <input type="text" class="title-input" value="${day.titolo}" placeholder="Titolo Giorno">
        <button class="btn ghost btn-delete-day">‚ùå</button>
      </div>
      <div class="sep"></div>
      <div class="supersets-container grid"></div>
      <button class="btn ghost btn-add-superset" style="margin-top: .75rem;">‚ûï Aggiungi Superserie</button>
    `;

    const supersetsContainer = dayCard.querySelector('.supersets-container');

    day.coppie.forEach((coppia) => {
      const supersetForm = createSupersetForm(coppia);
      supersetsContainer.appendChild(supersetForm);
    });

    editor.appendChild(dayCard);
  }

  const addDayBtn = document.createElement('button');
  addDayBtn.className = 'btn primary btn-add-day';
  addDayBtn.textContent = '‚ûï Aggiungi Giorno';
  addDayBtn.style.marginTop = '1rem';
  editor.appendChild(addDayBtn);
}

function savePlanFromEditor() {
  const newPlan = {};
  const editor = document.getElementById('planEditor');
  const dayCards = editor.querySelectorAll('.card[data-day-key]');

  dayCards.forEach(card => {
    const dayKey = card.dataset.dayKey;
    const titleInput = card.querySelector('input.title-input');
    const title = titleInput ? titleInput.value.trim() : '';

    if (!title) return;

    const supersetForms = card.querySelectorAll('.superset-form');
    const coppie = [];
    supersetForms.forEach(form => {
      const exAInput = form.querySelector('input.exA');
      const exBInput = form.querySelector('input.exB');
      const srInput = form.querySelector('input.sr');

      const exA = exAInput ? exAInput.value.trim() : '';
      const exB = exBInput ? exBInput.value.trim() : '';
      const sr = srInput ? srInput.value.trim() : '';

      if (exA || exB) {
        coppie.push([exA, exB, sr]);
      }
    });

    if (title) {
        newPlan[dayKey] = {
        titolo: title,
        coppie: coppie
        };
    }
  });

  plan = newPlan;
  localStorage.setItem('ws_plan', JSON.stringify(plan));

  modificaView.style.display = 'none';
  allenamentoView.style.display = 'block';
  document.getElementById('tabModifica').classList.remove('active');
  document.getElementById('tabAllenamento').classList.add('active');

  if (!plan[state.day]) {
    const firstDay = Object.keys(plan)[0] || null;
    state.day = firstDay;
    save();
  }

  renderWeekSelect();
  renderDayButtons();
  renderDay();

  alert('Piano salvato!');
}

function createSupersetForm(coppia = ["", "", ""]) {
  const [exA, exB, sr] = coppia;
  const supersetForm = document.createElement('div');
  supersetForm.className = 'superset-form';
  supersetForm.innerHTML = `
    <div class="form-group">
      <label>Esercizio A</label>
      <input type="text" class="exA" value="${exA}" placeholder="Es. Panca Piana">
    </div>
    <div class="form-group">
      <label>Esercizio B</label>
      <input type="text" class="exB" value="${exB}" placeholder="Es. Rematore (opzionale)">
    </div>
    <div class="form-group">
      <label>Serie/Reps</label>
      <input type="text" class="sr" value="${sr}" placeholder="Es. 3x10-12">
    </div>
    <div style="text-align:right; margin-top:.5rem;">
      <button class="btn ghost btn-delete-superset">‚ûñ Rimuovi</button>
    </div>
  `;
  return supersetForm;
}

function renderDayButtons() {
  const container = document.getElementById('dayButtons');
  container.innerHTML = ''; // Clear old buttons

  if (!plan || Object.keys(plan).length === 0) return;

  const dayKeys = Object.keys(plan).sort((a, b) => {
    const numA = parseInt(a.substring(1)) || 0;
    const numB = parseInt(b.substring(1)) || 0;
    return numA - numB;
  });

  dayKeys.forEach(dayKey => {
      const day = plan[dayKey];
      const button = document.createElement('button');
      button.className = 'chip';
      if (dayKey === state.day) {
          button.classList.add('primary');
      }
      button.dataset.day = dayKey;
      button.textContent = day.titolo.split('‚Äì')[0].trim() || dayKey;

      button.addEventListener('click', ()=>{
          state.day=dayKey;
          save();
          renderDay();
          renderDayButtons();
      });

      container.appendChild(button);
  });
}

function renderDay(){
  workouts.innerHTML = "";
  if (!state.day || !plan[state.day]) {
    workouts.innerHTML = `<p class="muted">Nessun giorno selezionato o il giorno non esiste pi√π. Selezionane uno o creane uno nuovo in "Gestisci".</p>`;
    return;
  }
  const day = plan[state.day];

  const title = document.createElement('h2');
  title.className='title'; title.textContent = day.titolo;
  workouts.appendChild(title);

  day.coppie.forEach(([A,B,SR],i)=>{
    const k = keyAB(A,B);
    const card = document.createElement('div'); card.className='card'; card.dataset.ex=k;
    card.innerHTML = `
      <div class="row">
        <div>
          <div class="subtitle"><strong>Superserie ${i+1}</strong></div>
          <div>${A} <span class="muted">+ ${B}</span></div>
          <div class="muted" data-serie>${SR}</div>
        </div>
        <div class="volbox">
          <div class="muted">Vol. A / B / Tot</div>
          <div class="vol"><span data-volA>-</span> / <span data-volB>-</span> / <span data-volT>-</span></div>
        </div>
      </div>

      <div class="sep"></div>

      ${(B && B !== "-") ? `
      <div class="grid two">
        <div>
          <div class="subtitle"><strong>${A}</strong></div>
          <div class="input-grid">
            <label>Peso (kg)<input type="number" step="0.5" inputmode="decimal" data-field="pesoA" value="${val(k,'pesoA')}"></label>
            <label>Reps<input type="number" step="1" inputmode="numeric" data-field="repsA" value="${val(k,'repsA')}"></label>
          </div>
        </div>
        <div>
          <div class="subtitle"><strong>${B}</strong></div>
          <div class="input-grid">
            <label>Peso (kg)<input type="number" step="0.5" inputmode="decimal" data-field="pesoB" value="${val(k,'pesoB')}"></label>
            <label>Reps<input type="number" step="1" inputmode="numeric" data-field="repsB" value="${val(k,'repsB')}"></label>
          </div>
        </div>
      </div>
      ` : `
      <div>
        <div class="subtitle"><strong>${A}</strong></div>
        <div class="input-grid">
          <label>Peso (kg)<input type="number" step="0.5" inputmode="decimal" data-field="pesoA" value="${val(k,'pesoA')}"></label>
          <label>Reps<input type="number" step="1" inputmode="numeric" data-field="repsA" value="${val(k,'repsA')}"></label>
        </div>
      </div>
      `}

      <label style="display:block;margin-top:.6rem">Note<br>
        <input type="text" data-field="note" value="${val(k,'note')}" style="width:100%">
      </label>
    `;
    workouts.appendChild(card);
  });

  workouts.querySelectorAll('[data-field]').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const f = e.target.getAttribute('data-field');
      const k = e.target.closest('[data-ex]').dataset.ex;
      setVal(k, f, e.target.value);
    });
  });
  computeVolumes();
}

/* ---------- App Logic ---------- */
function renderCharts() {
    const container = document.getElementById('chartContainer');
    container.innerHTML = '<p class="muted">Caricamento grafici...</p>';

    const allData = JSON.parse(localStorage.getItem('ws_data') || '{}');
    const currentPlan = JSON.parse(localStorage.getItem('ws_plan') || '{}');
    const exerciseData = {};

    // 1. Estrarre tutti i dati di volume per ogni esercizio
    for (const week in allData) {
        for (const dayKey in allData[week]) {
            const dayPlan = currentPlan[dayKey];
            if (!dayPlan) continue;

            const dayData = allData[week][dayKey];
            for (const exKey in dayData) {
                const couple = dayPlan.coppie.find(c => keyAB(c[0], c[1]) === exKey);
                if (!couple) continue;

                const [exA, exB, sr] = couple;
                const m = sr.match(/(\d+)x/);
                const sets = m ? parseInt(m[1]) : 1;
                const entry = dayData[exKey];

                if (exA && exA !== "-") {
                    if (!exerciseData[exA]) exerciseData[exA] = {};
                    const peso = parseFloat(entry.pesoA) || 0;
                    const reps = parseInt(entry.repsA) || 0;
                    exerciseData[exA][week] = Math.round(peso * reps * sets);
                }
                if (exB && exB !== "-") {
                    if (!exerciseData[exB]) exerciseData[exB] = {};
                    const peso = parseFloat(entry.pesoB) || 0;
                    const reps = parseInt(entry.repsB) || 0;
                    exerciseData[exB][week] = Math.round(peso * reps * sets);
                }
            }
        }
    }

    container.innerHTML = ''; // Pulisci
    const exercisesToShow = Object.keys(exerciseData).filter(ex => {
        // Mostra solo grafici con dati per pi√π di una settimana
        return Object.values(exerciseData[ex]).filter(v => v > 0).length > 1;
    });

    if (exercisesToShow.length === 0) {
        container.innerHTML = '<p class="muted">Non ci sono ancora abbastanza dati per generare i grafici. Completa almeno due settimane di allenamento per un esercizio.</p>';
        return;
    }

    exercisesToShow.sort().forEach(exName => {
        const weeklyVolumes = [];
        for (let i = 1; i <= 6; i++) {
            weeklyVolumes.push(exerciseData[exName][i] || 0);
        }
        const chartElement = createChart(exName, weeklyVolumes);
        container.appendChild(chartElement);
    });
}

function createChart(title, data) {
    const container = document.createElement('div');
    container.className = 'card'; // Usa lo stile card per coerenza
    container.innerHTML = `<div class="subtitle" style="margin-bottom:.5rem;"><strong>${title}</strong></div>`;

    const maxVal = Math.max(...data, 1); // Evita divisione per zero
    const svgHeight = 150;
    const barWidth = 35;
    const barMargin = 10;
    const svgWidth = (barWidth + barMargin) * data.length;

    let svg = `<svg width="100%" height="${svgHeight}" style="border-left:1px solid var(--border); border-bottom:1px solid var(--border);" viewBox="0 0 ${svgWidth} ${svgHeight}">`;

    data.forEach((value, i) => {
        const barHeight = Math.round((value / maxVal) * (svgHeight - 20)); // -20 per padding
        const x = i * (barWidth + barMargin);
        const y = svgHeight - barHeight;

        svg += `
            <rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" fill="var(--primary)" rx="4"></rect>
            <text x="${x + barWidth / 2}" y="${y - 5}" text-anchor="middle" font-size="12" fill="var(--text)">${value}</text>
        `;
    });

    svg += '</svg>';

    const labels = document.createElement('div');
    labels.style.display = 'flex';
    labels.style.justifyContent = 'space-around';
    labels.style.fontSize = '.8rem';
    labels.style.color = 'var(--muted)';
    labels.style.padding = '0 1rem';

    for(let i=1; i<= data.length; i++) {
        const label = document.createElement('span');
        label.textContent = `S${i}`;
        labels.appendChild(label)
    }

    container.innerHTML += svg;
    container.appendChild(labels);
    return container;
}


function resetWeek(){
  if(!confirm('Azzerare i dati di questa settimana?')) return;
  ensureWeek(); state.data[state.week] = { G1:{}, G2:{}, G3:{} }; save(); renderDay();
}

function switchTab(activeTab) {
    allenamentoView.style.display = 'none';
    graficoView.style.display = 'none';
    modificaView.style.display = 'none';
    document.getElementById('tabAllenamento').classList.remove('active');
    document.getElementById('tabGrafico').classList.remove('active');
    document.getElementById('tabModifica').classList.remove('active');

    if (activeTab === 'allenamento') {
        allenamentoView.style.display = 'block';
        document.getElementById('tabAllenamento').classList.add('active');
    } else if (activeTab === 'grafico') {
        graficoView.style.display = 'block';
        document.getElementById('tabGrafico').classList.add('active');
        renderCharts();
    } else if (activeTab === 'modifica') {
        modificaView.style.display = 'block';
        document.getElementById('tabModifica').classList.add('active');
        renderPlanEditor();
    }
}

/* ---------- Bindings ---------- */
document.getElementById('resetWeek').addEventListener('click', resetWeek);
document.getElementById('weekSelect').addEventListener('change', e=>{ state.week=+e.target.value; save(); renderWeekSelect(); renderDay(); });

document.getElementById('tabAllenamento').addEventListener('click', () => switchTab('allenamento'));
document.getElementById('tabGrafico').addEventListener('click', () => switchTab('grafico'));
document.getElementById('tabModifica').addEventListener('click', () => switchTab('modifica'));

document.getElementById('planEditor').addEventListener('click', (e) => {
  if (e.target.classList.contains('btn-delete-day')) {
    if (confirm('Sei sicuro di voler eliminare questo giorno?')) {
      e.target.closest('.card[data-day-key]').remove();
    }
  }

  if (e.target.classList.contains('btn-delete-superset')) {
    e.target.closest('.superset-form').remove();
  }

  if (e.target.classList.contains('btn-add-superset')) {
    const container = e.target.previousElementSibling;
    if (container && container.classList.contains('supersets-container')) {
      container.appendChild(createSupersetForm());
    }
  }

  if (e.target.classList.contains('btn-add-day')) {
    const dayCards = document.querySelectorAll('#planEditor .card[data-day-key]');
    const dayKeys = Array.from(dayCards).map(c => c.dataset.dayKey);
    const existingDayNums = dayKeys.map(k => parseInt(k.replace('G', ''))).filter(n => !isNaN(n));
    const nextDayNum = existingDayNums.length > 0 ? Math.max(...existingDayNums) + 1 : 1;
    const newDayKey = `G${nextDayNum}`;

    const newDayCard = document.createElement('div');
    newDayCard.className = 'card';
    newDayCard.dataset.dayKey = newDayKey;
    newDayCard.innerHTML = `
      <div class="row">
        <input type="text" class="title" style="flex-grow:1; background:transparent; border:none; font-size:1rem; font-weight:700;" value="Nuovo Giorno ${nextDayNum}" placeholder="Titolo Giorno">
        <button class="btn ghost btn-delete-day">‚ùå</button>
      </div>
      <div class="sep"></div>
      <div class="supersets-container grid"></div>
      <button class="btn ghost btn-add-superset" style="margin-top: .75rem;">‚ûï Aggiungi Superserie</button>
    `;
    e.target.before(newDayCard);
  }
});

document.getElementById('modificaView').addEventListener('click', e => {
  if (e.target.id === 'savePlanBtn') {
    savePlanFromEditor();
  }
});

/* ---------- Init ---------- */
renderWeekSelect(); renderDayButtons(); renderDay(); computeVolumes();

/* ---------- PWA ---------- */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}));
}
</script>
</body>
</html>
